# Bitcoin Quest: A Top-Down Quiz Adventure! (Phaser 3 + Cordova + Gemini AI)

![screenshot](screenshot.png)

Embark on **Bitcoin Quest**, a retro-inspired, top-down educational game where learning about Bitcoin is an exciting adventure! Built with Phaser 3, Apache Cordova, and powered by Google's Gemini AI for dynamic quiz generation, this game challenges your knowledge of Bitcoin concepts through interactive gameplay, engaging NPC interactions, and timed quizzes. Dive into a pixel-art world and earn Satoshis as you master the fundamentals of Bitcoin.

This project was developed for the **Amazon Q Developer "Quack The Code" Challenge**, aiming to showcase innovation in entertainment, explore new development possibilities, and leverage AI for a smarter workflow.

## Play Online Now!

Ready to test your Bitcoin knowledge? Play the latest version here:
*   **Multiplayer Link (Render.com):** [https://mmo.hermit.onl/](https://mmo.hermit.onl/)
*   Backup Link (Render): [https://game-api-c2gn.onrender.com/](https://game-api-c2gn.onrender.com/) (API Server)
*   **Old Link (Vercel - Single Player):** [https://play.hermit.onl/](https://play.hermit.onl/)
*   Backup Link (Vercel): [https://phaser-beta.vercel.app/](https://phaser-beta.vercel.app/)

## Key Features

*   **Engaging Gameplay:** Explore a 2D world, interact with unique characters, and undertake quiz challenges.
*   **Learn & Earn:** Gain knowledge about Bitcoin concepts from "Knowledge NPCs" and earn in-game Satoshis.
*   **Interactive Quizzes:** Test your understanding with timed, multiple-choice quizzes where you move your player to the correct answer zone.
*   **AI-Powered Bitcoin Quizzes:** Encounter special NPCs that trigger quizzes dynamically generated by Google's Gemini AI, offering fresh questions about Bitcoin.
*   **Retro Pixel Art Style:** Enjoy a visually appealing game reminiscent of 16-bit classics.
*   **Cross-Platform Potential:** Built with Cordova for web deployment and future mobile possibilities.
*   **Basic Multiplayer:** See other players move in real-time using Socket.IO.
*   **Educational Focus:** Designed to make learning complex Bitcoin topics fun and accessible for everyone.

## AI-Powered Bitcoin Quiz

A core feature of Bitcoin Quest is the integration of dynamically generated quizzes powered by Google's Gemini AI.
*   **Trigger:** Specific Non-Player Characters (NPCs), like the copper golem (`npc2`), are designated to provide AI-generated quizzes.
*   **Content:** Currently, these quizzes focus on the topic of "Bitcoin" and consist of 5 questions.
*   **Mechanism & Caching Strategy:**
    1.  **Request:** When the player interacts with an AI Quiz NPC, the Phaser client ([`www/js/index.js`](www/js/index.js:1)) requests a quiz from `GET /api/quiz` with `topic` and `count` parameters (e.g., `topic=Bitcoin&count=5`).
    2.  **Cache Check (Server-Side - [`api/index.js`](api/index.js:1)):**
        *   The server first checks its in-memory cache for valid (non-expired) versions of the requested quiz (topic & count).
        *   The cache can store up to 10 different versions of a quiz for each unique topic/count combination. Each version has a 5-minute expiry from when it was fetched.
        *   Answer options for all cached quizzes are pre-shuffled.
        *   If a valid, non-expired version is found, the most recently fetched one is served immediately (with shuffled answers).
    3.  **Cache Miss / Stale-While-Revalidate:**
        *   If no valid cached version is found for the specific request:
            *   The server *immediately* responds with a default, pre-defined "Bitcoin Basics" quiz (with its answer options shuffled on-the-fly). This ensures a fast user experience.
            *   Simultaneously, in the background, the server triggers a call to the Gemini AI to generate the *actually requested* quiz (e.g., "Bitcoin", 5 questions).
    4.  **Gemini AI Interaction (Background or Initial Cache Fill):**
        *   The backend server ([`api/index.js`](api/index.js:1)) constructs a detailed prompt for the Gemini AI model.
        *   Gemini generates the quiz (questions, options, correct answers) as JSON. The backend parses this, handling potential markdown wrapping.
    5.  **Caching New Quiz & Answer Shuffling:**
        *   The newly fetched quiz from Gemini has its answer options shuffled for each question.
        *   This new, shuffled quiz version is then added to the cache for the specific topic/count, respecting the 10-version limit per key (oldest is removed if limit is exceeded).
    6.  **Client-Side Quiz:** The Phaser game client receives the quiz data (either from cache or the default quiz) and runs the interactive quiz session.
*   **Benefits:**
    *   **Reduced Perceived Latency:** The "stale-while-revalidate" strategy with a default quiz ensures players get a quiz quickly, even if their specific request isn't cached.
    *   **Variety & Replayability:** Caching multiple (up to 10) different AI-generated versions for each quiz type, combined with shuffling answer options, provides a fresh experience and prevents players from memorizing answer positions or question sets too easily.
    *   **Efficient API Usage:** Caching reduces redundant calls to the Gemini API for frequently requested quiz types.

## Multiplayer with Socket.IO

Bitcoin Quest now features basic real-time multiplayer functionality, allowing players to see each other move within the game world. This is achieved using Socket.IO.

*   **Backend:** An Express server (`api/index.js`) handles Socket.IO connections, manages player states (positions), and broadcasts updates.
*   **Frontend:** The Phaser client (`www/js/index.js`) connects to the Socket.IO server, sends local player movement, and receives updates about other players to render them on screen.
*   **Synchronization:** Player positions are synchronized across all connected clients.
*   **Event Handling:** Key Socket.IO events handled include: `connect`, `currentPlayers`, `newPlayer`, `playerMoved`, and `playerDisconnected`.

## Gameplay Deep Dive

*   **Movement:**
    *   **Desktop:** Arrow Keys.
    *   **Mobile/Touch:** On-screen D-pad.
*   **Interaction:**
    *   **Desktop:** 'E' key near NPCs.
    *   **Mobile/Touch:** On-screen interact button (target icon).
*   **Knowledge NPCs:** Provide lessons and reward Sats.
*   **Quiz NPCs:**
    *   **Predefined Quizzes:** Offer challenges on specific topics with a Sat cost.
    *   **AI-Generated Quizzes:** Specific NPCs (e.g., copper golem) trigger AI-powered Bitcoin quizzes (currently 5 questions, no Sat cost to attempt).
*   **Dynamic Quiz Mechanics:** For all quizzes, a question with multiple-choice answers (A, B, C, D) is displayed with a timer. Move your player into the zone corresponding to the correct answer.
*   **Scoring & Progression:** Earn Sats for correct answers.

## Amazon Q Developer Challenge Context

This project proudly addresses multiple prompts of the Amazon Q Developer Challenge:
*   **Prompt 2: That's Entertainment!:** An educational game designed to entertain.
*   **Prompt 3: Exploring the Possibilities:** Migration from a 3D prototype to 2D Phaser/Cordova, significantly aided by AI-assisted development (conceptualized with Amazon Q, implemented with available tools including Gemini for quiz content).
*   **Prompt 1: Crushing the Command Line:** Foundation laid for future CLI automation via `AmazonQContext.md`.

See the **"Leveraging Amazon Q Developer"** section and `AmazonQContext.md` for more.

## Technical Stack

*   **Game Engine:** Phaser 3
*   **Core Language:** JavaScript (ES6+)
*   **AI for Quiz Generation:** Google Gemini AI (via `@google/generative-ai` SDK)
*   **Backend Framework:** Node.js with Express
*   **Real-time Communication:** Socket.IO
*   **Mobile Wrapper (Optional):** Apache Cordova
*   **Deployment (Web):** Render.com (for API and game client), Vercel (alternative for game client)

## Leveraging Amazon Q Developer

Amazon Q Developer was a crucial partner. The `AmazonQContext.md` file was created to provide Amazon Q with deep project understanding.
**How Amazon Q was/can be utilized (including for features like the AI Quiz):**
1.  **Accelerated Development:** Assisting in conceptualizing and generating boilerplate for features like the `/api/quiz` endpoint, Phaser game logic for handling quiz data, and UI updates. Assisted in translating concepts and code from the previous 3D Hytopia SDK version to Phaser 3.
2.  **Enhanced Problem Solving:** Using profiles (e.g., `phaser-gamedev`, `node-api-dev`) for targeted advice.
3.  **Strategic Agentic Commands (Conceptualized):** `/transform`, `/dev`, `/review`, `/test`.
4.  **Intelligent CLI Automation (Future Vision).**

Refer to **[`AmazonQContext.md`](AmazonQContext.md)** for the full AI collaboration strategy.

## Project Structure Overview

*   `www/`: Phaser game assets (HTML, CSS, JS, images).
    *   `www/js/index.js`: Main Phaser game logic, including quiz handling.
*   `api/index.js`: Node.js Express backend, Socket.IO server, and Gemini AI interaction for quiz generation.
*   `config.xml`: Cordova configuration.
*   `render.yaml`: Render.com deployment configuration.
*   `AmazonQContext.md`: Context for Amazon Q Developer.
*   `.env`: For environment variables (e.g., `GEMINI_API_KEY`).

## Prerequisites

*   [Node.js](https://nodejs.org/) (includes `npm`). Version specified in `package.json` `engines` field (e.g., 18.x) is recommended for the backend.
*   Apache Cordova CLI (optional, for mobile builds): `sudo npm install -g cordova`
*   **Gemini API Key:** You need a valid API key from Google AI Studio. Create a `.env` file in the project root and add your key:
    ```
    GEMINI_API_KEY=YOUR_API_KEY_HERE
    ```

## Setup and Installation

1.  **Clone the Repository:**
    ```bash
    git clone https://github.com/hermitonl/mmo.git
    cd mmo
    ```
2.  **Install Project Dependencies:**
    ```bash
    npm install
    ```
    (Troubleshooting `EACCES` errors: `sudo rm -rf node_modules && npm install`)
3.  **Create `.env` file:** As described in Prerequisites, add your `GEMINI_API_KEY`.
4.  **Cordova Platform (Optional):**
    ```bash
    cordova platform add browser # For browser testing via Cordova
    # cordova platform add android
    ```

## Running the Game Locally (Desktop & Mobile)

This setup runs the game with AI quiz generation and multiplayer functionality locally.

1.  **Start the Backend Server (API, Gemini Quiz, Socket.IO):**
    Open a terminal in the project root:
    ```bash
    node api/index.js
    ```
    Expected output: `[API Server] Listening on http://localhost:3001` and other logs.

2.  **Start the Frontend Development Server (with Proxy):**
    Open another terminal in the project root:
    ```bash
    npx http-server www -p 8080 -c-1 --cors --proxy http://localhost:3001
    ```
    This serves `www/` on port `8080` and proxies API/Socket.IO requests to port `3001`.

3.  **Accessing the Game:**
    *   **Desktop:** `http://localhost:8080`
    *   **Mobile (same network):** `http://YOUR_COMPUTER_IP_ADDRESS:8080` (Find IP via `ipconfig getifaddr en0` on macOS, `ipconfig` on Windows, `hostname -I` on Linux).

## Deployment

### Render.com (Recommended for Backend & Frontend)
The project is configured for easy deployment to Render.com using `render.yaml`.
*   **`game-api` (Web Service):** Runs `api/index.js`. Requires `GEMINI_API_KEY` and `CLIENT_ORIGIN` (e.g., your game client's Render URL like `https://mmo.hermit.onl`) environment variables set on Render.
*   **`game-client` (Static Site):** Serves the `www` directory.
The `www/js/index.js` connects to the deployed `game-api` URL for Socket.IO and quizzes.

### Vercel (Alternative for Frontend)
`vercel.json` is included for deploying the `www` directory as a static site. The backend (`api/index.js`) can also be deployed as a Vercel serverless function, but Render.com is generally better for persistent Socket.IO connections. If using Vercel for the API, ensure `GEMINI_API_KEY` is set as an environment variable.

## Future Enhancements

*   Expanded Bitcoin curriculum.
*   Player inventory and shop.
*   More diverse quiz types and AI-generated content.
*   Customizable avatars.
*   Leaderboards.

## Contributing

Contributions, feedback, and suggestions are welcome! Please open an issue or submit a pull request.
